<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>dodgr_centrality — dodgr_centrality • dodgr</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="dodgr_centrality — dodgr_centrality"><meta property="og:description" content="Calculate betweenness centrality for a 'dodgr' network, in either vertex- or
edge-based form."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dodgr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.13.023</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ATFutures/dodgr" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>dodgr_centrality</h1>
    <small class="dont-index">Source: <a href="https://github.com/ATFutures/dodgr/blob/HEAD/R/centrality.R" class="external-link"><code>R/centrality.R</code></a></small>
    <div class="hidden name"><code>dodgr_centrality.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Calculate betweenness centrality for a 'dodgr' network, in either vertex- or
edge-based form.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">dodgr_centrality</span><span class="op">(</span>
  <span class="va">graph</span>,
  contract <span class="op">=</span> <span class="cn">TRUE</span>,
  edges <span class="op">=</span> <span class="cn">TRUE</span>,
  column <span class="op">=</span> <span class="st">"d_weighted"</span>,
  vert_wts <span class="op">=</span> <span class="cn">NULL</span>,
  dist_threshold <span class="op">=</span> <span class="cn">NULL</span>,
  heap <span class="op">=</span> <span class="st">"BHeap"</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>graph</dt>
<dd><p>'data.frame' or equivalent object representing the network
graph (see Details)</p></dd>
<dt>contract</dt>
<dd><p>If 'TRUE', centrality is calculated on contracted graph
before mapping back on to the original full graph. Note that for street
networks, in particular those obtained from the <span class="pkg">osmdata</span> package, vertex
placement is effectively arbitrary except at junctions; centrality for such
graphs should only be calculated between the latter points, and thus
'contract' should always be 'TRUE'.</p></dd>
<dt>edges</dt>
<dd><p>If 'TRUE', centrality is calculated for graph edges, returning
the input 'graph' with an additional 'centrality' column; otherwise
centrality is calculated for vertices, returning the equivalent of
'dodgr_vertices(graph)', with an additional vertex-based 'centrality' column.</p></dd>
<dt>column</dt>
<dd><p>Column of graph defining the edge properties used to calculate
centrality (see Note).</p></dd>
<dt>vert_wts</dt>
<dd><p>Optional vector of length equal to number of vertices
(<code>nrow(dodgr_vertices(graph))</code>), to enable centrality to be calculated in
weighted form, such that centrality measured from each vertex will be
weighted by the specified amount.</p></dd>
<dt>dist_threshold</dt>
<dd><p>If not 'NULL', only calculate centrality for each point
out to specified threshold. Setting values for this will result in
approximate estimates for centrality, yet with considerable gains in
computational efficiency. For sufficiently large values, approximations will
be accurate to within some constant multiplier. Appropriate values can be
established via the <a href="estimate_centrality_threshold.html">estimate_centrality_threshold</a> function.</p></dd>
<dt>heap</dt>
<dd><p>Type of heap to use in priority queue. Options include
Fibonacci Heap (default; 'FHeap'), Binary Heap ('BHeap'),
Trinomial Heap ('TriHeap'), Extended Trinomial Heap
('TriHeapExt', and 2-3 Heap ('Heap23').</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Modified version of graph with additional 'centrality' column added.</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>The <code>column</code> parameter is by default <code>d_weighted</code>, meaning centrality
is calculated by routing according to weighted distances. Other possible
values for this parameter are</p><ul><li><p><code>d</code> for unweighted distances</p></li>
<li><p><code>time</code> for unweighted time-based routing</p></li>
<li><p><code>time_weighted</code> for weighted time-based routing</p></li>
</ul><p>Centrality is calculated by default using parallel computation with the
maximal number of available cores or threads. This number can be reduced by
specifying a value via
<code>RcppParallel::setThreadOptions (numThreads = &lt;desired_number&gt;)</code>.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other centrality: 
<code><a href="estimate_centrality_threshold.html">estimate_centrality_threshold</a>()</code>,
<code><a href="estimate_centrality_time.html">estimate_centrality_time</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="va">graph_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="weight_streetnet.html">weight_streetnet</a></span> <span class="op">(</span><span class="va">hampi</span><span class="op">)</span></span>
<span class="r-in"><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="dodgr_contract_graph.html">dodgr_contract_graph</a></span> <span class="op">(</span><span class="va">graph_full</span><span class="op">)</span></span>
<span class="r-in"><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu">dodgr_centrality</span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># 'graph' is then the contracted graph with an additional 'centrality' column</span></span>
<span class="r-in"><span class="co"># Same calculation via 'igraph':</span></span>
<span class="r-in"><span class="va">igr</span> <span class="op">&lt;-</span> <span class="fu"><a href="dodgr_to_igraph.html">dodgr_to_igraph</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required namespace: igraph</span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span> <span class="op">(</span><span class="va"><a href="https://igraph.org" class="external-link">igraph</a></span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘igraph’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     decompose, spectrum</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     union</span>
<span class="r-in"><span class="va">cent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/betweenness.html" class="external-link">edge_betweenness</a></span> <span class="op">(</span><span class="va">igr</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span> <span class="op">(</span><span class="va">cent</span>, <span class="va">graph</span><span class="op">$</span><span class="va">centrality</span><span class="op">)</span> <span class="co"># TRUE</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-in"><span class="co"># Values of centrality between all junctions in the contracted graph can then</span></span>
<span class="r-in"><span class="co"># be mapped back onto the original full network by "uncontracting":</span></span>
<span class="r-in"><span class="va">graph_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="dodgr_uncontract_graph.html">dodgr_uncontract_graph</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># For visualisation, it is generally necessary to merge the directed edges to</span></span>
<span class="r-in"><span class="co"># form an equivalent undirected graph. Conversion to 'sf' format via</span></span>
<span class="r-in"><span class="co"># 'dodgr_to_sf()' is also useful for many visualisation routines.</span></span>
<span class="r-in"><span class="va">graph_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="merge_directed_graph.html">merge_directed_graph</a></span> <span class="op">(</span><span class="va">graph_full</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">    <span class="fu"><a href="dodgr_to_sf.html">dodgr_to_sf</a></span> <span class="op">(</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required namespace: sf</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> old-style crs object detected; please recreate object with a recent sf::st_crs()</span>
<span class="r-in"></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span> <span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview" class="external-link">mapview</a></span><span class="op">)</span></span>
<span class="r-in"><span class="va">centrality</span> <span class="op">&lt;-</span> <span class="va">graph_sf</span><span class="op">$</span><span class="va">centrality</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span> <span class="op">(</span><span class="va">graph_sf</span><span class="op">$</span><span class="va">centrality</span><span class="op">)</span></span>
<span class="r-in"><span class="va">ncols</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span class="r-in"><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"lawngreen"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span> <span class="op">(</span><span class="va">cols</span><span class="op">)</span> <span class="op">(</span><span class="va">ncols</span><span class="op">)</span> <span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span> <span class="op">(</span><span class="va">ncols</span> <span class="op">*</span> <span class="va">centrality</span><span class="op">)</span><span class="op">]</span></span>
<span class="r-in"><span class="fu">mapview</span> <span class="op">(</span><span class="va">graph_sf</span>, color <span class="op">=</span> <span class="va">cols</span>, lwd <span class="op">=</span> <span class="fl">10</span> <span class="op">*</span> <span class="va">centrality</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># An example of flow aggregation across a generic (non-OSM) highway,</span></span>
<span class="r-in"><span class="co"># represented as the 'routes_fast' object of the \pkg{stplanr} package,</span></span>
<span class="r-in"><span class="co"># which is a SpatialLinesDataFrame containing commuter densities along</span></span>
<span class="r-in"><span class="co"># components of a street network.</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span> <span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/stplanr" class="external-link">stplanr</a></span><span class="op">)</span></span>
<span class="r-in"><span class="co"># merge all of the 'routes_fast' lines into a single network</span></span>
<span class="r-in"><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">overline</span> <span class="op">(</span><span class="va">routes_fast</span>, attrib <span class="op">=</span> <span class="st">"length"</span>, buff_dist <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span class="r-in"><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span> <span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># Convert to a 'dodgr' network, for which we need to specify both a 'type'</span></span>
<span class="r-in"><span class="co"># and 'id' column.</span></span>
<span class="r-in"><span class="va">r</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span class="r-in"><span class="va">r</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">graph_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="weight_streetnet.html">weight_streetnet</a></span> <span class="op">(</span><span class="va">r</span>, type_col <span class="op">=</span> <span class="st">"type"</span>, id_col <span class="op">=</span> <span class="st">"id"</span>,</span>
<span class="r-in">                                wt_profile <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># convert to contracted form, retaining junction vertices only, and append</span></span>
<span class="r-in"><span class="co"># 'centrality' column</span></span>
<span class="r-in"><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="dodgr_contract_graph.html">dodgr_contract_graph</a></span> <span class="op">(</span><span class="va">graph_full</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">    <span class="fu">dodgr_centrality</span> <span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="co">#' expand back to full graph; merge directed flows; and convert result to</span></span>
<span class="r-in"><span class="co"># 'sf'-format for plotting</span></span>
<span class="r-in"><span class="va">graph_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="dodgr_uncontract_graph.html">dodgr_uncontract_graph</a></span> <span class="op">(</span><span class="va">graph</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">    <span class="fu"><a href="merge_directed_graph.html">merge_directed_graph</a></span> <span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">    <span class="fu"><a href="dodgr_to_sf.html">dodgr_to_sf</a></span> <span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span> <span class="op">(</span><span class="va">graph_sf</span> <span class="op">[</span><span class="st">"centrality"</span><span class="op">]</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Mark Padgham, Andreas Petutschnig.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer></div>

  


  

  </body></html>

